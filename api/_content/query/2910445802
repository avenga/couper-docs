[{"_path":"/configuration/block/environment","_draft":false,"_partial":false,"_empty":false,"title":"Environment","description":"","excerpt":{"type":"root","children":[{"type":"element","tag":"h3","props":{"id":"environment-block"},"children":[{"type":"text","value":"Environment Block"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"environment"}]},{"type":"text","value":" block lets you refine the Couper configuration based on the set\n"},{"type":"element","tag":"a","props":{"href":"./CLI.md#global-options"},"children":[{"type":"text","value":"environment"}]},{"type":"text","value":"."}]},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{"align":"left"},"children":[{"type":"text","value":"Block name"}]},{"type":"element","tag":"th","props":{"align":"left"},"children":[{"type":"text","value":"Context"}]},{"type":"element","tag":"th","props":{"align":"left"},"children":[{"type":"text","value":"Label"}]},{"type":"element","tag":"th","props":{"align":"left"},"children":[{"type":"text","value":"Nested block(s)"}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"environment"}]}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"text","value":"Overall."}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"text","value":"⚠ required, multiple labels are supported."}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"text","value":"All configuration blocks of Couper."}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"environment"}]},{"type":"text","value":" block works like a preprocessor. If the label of an "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"environment"}]},{"type":"text","value":"\nblock do not match the set "},{"type":"element","tag":"a","props":{"href":"./CLI.md#global-options"},"children":[{"type":"text","value":"environment"}]},{"type":"text","value":" value, the preprocessor\nremoves this block and their content. Otherwise, the content of the block is applied\nto the configuration."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If the "},{"type":"element","tag":"a","props":{"href":"./CLI.md#global-options"},"children":[{"type":"text","value":"environment"}]},{"type":"text","value":" value set to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"prod"}]},{"type":"text","value":", the following configuration:"}]},{"type":"element","tag":"code","props":{"code":"server {\n    api \"protected\" {\n        endpoint \"/secure\" {\n            environment \"prod\" {\n                access_control = [\"jwt\"]\n            }\n\n            proxy {\n                environment \"prod\" {\n                    url = \"https://protected-resource.org\"\n                }\n                environment \"stage\" {\n                    url = \"https://test-resource.org\"\n                }\n            }\n        }\n    }\n}\n","language":"hcl"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"server {\n    api \"protected\" {\n        endpoint \"/secure\" {\n            environment \"prod\" {\n                access_control = [\"jwt\"]\n            }\n\n            proxy {\n                environment \"prod\" {\n                    url = \"https://protected-resource.org\"\n                }\n                environment \"stage\" {\n                    url = \"https://test-resource.org\"\n                }\n            }\n        }\n    }\n}\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"produces after the preprocessing the following configuration:"}]},{"type":"element","tag":"code","props":{"code":"server {\n    api \"protected\" {\n        endpoint \"/secure\" {\n            access_control = [\"jwt\"]\n\n            proxy {\n                url = \"https://protected-resource.org\"\n            }\n        }\n    }\n}\n","language":"hcl"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"server {\n    api \"protected\" {\n        endpoint \"/secure\" {\n            access_control = [\"jwt\"]\n\n            proxy {\n                url = \"https://protected-resource.org\"\n            }\n        }\n    }\n}\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Note:"}]},{"type":"text","value":" The value of the environment set via "},{"type":"element","tag":"a","props":{"href":"#defaults-block"},"children":[{"type":"text","value":"Defaults Block"}]},{"type":"text","value":" is ignored."}]}]},"_type":"markdown","_id":"content:2.configuration:4.block:environment.md","_source":"content","_file":"2.configuration/4.block/environment.md","_extension":"md"},{"_path":"/configuration/block/health","_draft":false,"_partial":false,"_empty":false,"title":"Health","description":"Defines a recurring health check request for its backend. Results can be obtained via the backends.<label>.health variables.\nChanges in health states and related requests will be logged. Default User-Agent will be Couper / <version> health-check if not provided\nvia headers attribute. An unhealthy backend will return with a backend_unhealthy error.","excerpt":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"health"},"children":[{"type":"text","value":"Health"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Defines a recurring health check request for its backend. Results can be obtained via the "},{"type":"element","tag":"a","props":{"href":"#backends"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"backends.<label>.health"}]},{"type":"text","value":" variables"}]},{"type":"text","value":".\nChanges in health states and related requests will be logged. Default User-Agent will be "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Couper / <version> health-check"}]},{"type":"text","value":" if not provided\nvia "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"headers"}]},{"type":"text","value":" attribute. An unhealthy backend will return with a "},{"type":"element","tag":"a","props":{"href":"ERRORS.md#api-error-types"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"backend_unhealthy"}]}]},{"type":"text","value":" error."}]},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{"align":"left"},"children":[{"type":"text","value":"Block name"}]},{"type":"element","tag":"th","props":{"align":"left"},"children":[{"type":"text","value":"Context"}]},{"type":"element","tag":"th","props":{"align":"left"},"children":[{"type":"text","value":"Label"}]},{"type":"element","tag":"th","props":{"align":"left"},"children":[{"type":"text","value":"Nested block"}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"beta_health"}]}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"a","props":{"href":"#backend-block"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"backend"}]},{"type":"text","value":" block"}]}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"text","value":"–"}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[]}]}]}]},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{"align":"left"},"children":[{"type":"text","value":"Attributes"}]},{"type":"element","tag":"th","props":{"align":"left"},"children":[{"type":"text","value":"Type"}]},{"type":"element","tag":"th","props":{"align":"left"},"children":[{"type":"text","value":"Default"}]},{"type":"element","tag":"th","props":{"align":"left"},"children":[{"type":"text","value":"Description"}]},{"type":"element","tag":"th","props":{"align":"left"},"children":[{"type":"text","value":"Characteristics"}]},{"type":"element","tag":"th","props":{"align":"left"},"children":[{"type":"text","value":"Example"}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"expected_status"}]}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"text","value":"tuple (number)"}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"[200, 204, 301]"}]}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"text","value":"wanted response status code"}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"expected_status = [418]"}]}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"expected_text"}]}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"text","value":"string"}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"text","value":"–"}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"text","value":"text response body must contain"}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"expected_text = \"alive\""}]}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"failure_threshold"}]}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"text","value":"number"}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"2"}]}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"text","value":"failed checks needed to consider backend unhealthy"}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"failure_threshold = 3"}]}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"headers"}]}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"text","value":"object"}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"text","value":"–"}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"text","value":"request headers"}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"headers = {User-Agent = \"health\"}"}]}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"interval"}]}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"a","props":{"href":"#duration"},"children":[{"type":"text","value":"duration"}]}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"\"1s\""}]}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"text","value":"time interval for recheck"}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"timeout = \"5s\""}]}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"path"}]}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"text","value":"string"}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"text","value":"–"}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"text","value":"URL path/query on backend host"}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"path = \"/health\""}]}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"timeout"}]}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"a","props":{"href":"#duration"},"children":[{"type":"text","value":"duration"}]}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"\"2s\""}]}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"text","value":"maximum allowed time limit"}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"text","value":"bounded by "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"interval"}]}]},{"type":"element","tag":"td","props":{"align":"left"},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"timeout = \"3s\""}]}]}]}]}]}]},"_type":"markdown","_id":"content:2.configuration:4.block:health.md","_source":"content","_file":"2.configuration/4.block/health.md","_extension":"md"}]